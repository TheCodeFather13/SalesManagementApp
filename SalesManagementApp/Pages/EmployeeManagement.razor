@page "/EmployeeManagement"
@using SalesManagementApp.Entities
@using SalesManagementApp.Models
@using SalesManagementApp.Services.Contracts
@using Syncfusion.Blazor.Grids

@inject IEmployeeManagementService EmployeeManagementService
   
<h3>Employee Management</h3>

<div style="max-width:1000px">
    <SfGrid DataSource="employeeData">
        <GridEditSettings AllowEditing="true"></GridEditSettings>
        <GridPageSettings PageSize="10"></GridPageSettings>      
         <GridColumns>
             <GridColumn IsPrimaryKey="true" Field="@nameof(EmployeeModel.Id)" Width="60px"></GridColumn>
             <GridColumn HeaderText="First Name" Field="@nameof(EmployeeModel.FirstName)"></GridColumn>
             <GridColumn HeaderText="Last Name" Field="@nameof(EmployeeModel.LastName)"></GridColumn>
             <GridForeignColumn HeaderText="Designation" TValue="EmployeeJobTitle" 
                                            Field="@nameof(EmployeeModel.EmployeeJobTitleId)"
                                            ForeignDataSource="employeeJobTitleData"
                                            ForeignKeyValue="Name" Width="100px">
              <EditTemplate>               
                
                  <Syncfusion.Blazor.DropDowns.SfDropDownList @bind-value="@((context as EmployeeModel).EmployeeJobTitleId)" 
                                        ID="EmployeeJobTitleId"
                                        DataSource="employeeJobTitleData" TItem="EmployeeJobTitle"
                                        TValue="int">

                  <Syncfusion.Blazor.DropDowns.DropDownListFieldSettings Text="Name" Value="EmployeeJobTitleId">
                  </Syncfusion.Blazor.DropDowns.DropDownListFieldSettings>

                  </Syncfusion.Blazor.DropDowns.SfDropDownList>
              </EditTemplate>

             </GridForeignColumn>
             <GridColumn Field="@nameof(EmployeeModel.Gender)"></GridColumn>
             <GridColumn Field="@nameof(EmployeeModel.DateOfBirth)" Format="d"></GridColumn>
             <GridColumn HeaderText="Reports" Field="@nameof(EmployeeModel.ReportToEmpId)" TextAlign="TextAlign.Center" Width="100px"></GridColumn>
        </GridColumns>
    </SfGrid>
</div>

@code {
    private List<EmployeeModel>? employeeData = null;
    private List<EmployeeJobTitle>? employeeJobTitleData;
    // private List<object> toolbar = new List<object> { "Add", "Edit", "Delete", "Update", "Cancel", "Search" };

    protected override async Task OnInitializedAsync()
    {
        employeeData = await EmployeeManagementService.GetEmployees();
        employeeJobTitleData = await EmployeeManagementService.GetJobTitles();
    }
}
